# CODE OF JOKER AI Chat UI è¦ä»¶å®šç¾©æ›¸

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0
**ä½œæˆæ—¥:** 2026-01-29
**é–¢é€£æ–‡æ›¸:** [AI_CLIENT_REQUIREMENTS.md](./AI_CLIENT_REQUIREMENTS.md)

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

AIã®æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯è¦–åŒ–ã—ã€æˆ¦ç•¥çš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å¯èƒ½ã«ã™ã‚‹ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¦ä»¶ã‚’å®šç¾©ã™ã‚‹ã€‚

### 1.2 è¨­è¨ˆåŸå‰‡

- **é€æ˜æ€§**: AIã®æ„æ€æ±ºå®šéç¨‹ã‚’æ˜ç¢ºã«è¡¨ç¤º
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ€§**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæˆ¦ç•¥ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¯èƒ½
- **éä¾µå…¥æ€§**: ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’å¦¨ã’ãªã„UIè¨­è¨ˆ
- **åŠ¹ç‡æ€§**: é‡è¦ãªæƒ…å ±ã‚’ç°¡æ½”ã«è¡¨ç¤º

---

## 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—å®šç¾©

### 2.1 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ†ã‚´ãƒª

| ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | ç™ºç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|---------|------|---------------|
| `pregame_analysis` | ã‚²ãƒ¼ãƒ é–‹å§‹å‰åˆ†æ | ãƒãƒƒãƒãƒ³ã‚°å¾Œã€œãƒãƒªã‚¬ãƒ³å‰ |
| `periodic_analysis` | å®šæœŸåˆ†æ | 2ãƒ©ã‚¦ãƒ³ãƒ‰ã”ã¨ |
| `turn_decision` | ã‚¿ãƒ¼ãƒ³ä¸­ã®æ„æ€æ±ºå®š | è‡ªã‚¿ãƒ¼ãƒ³ä¸­ |
| `choice_response` | é¸æŠè‚¢ã¸ã®å¿œç­” | Choicesã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æ™‚ |
| `strategy_update` | æˆ¦ç•¥å¤‰æ›´é€šçŸ¥ | çŠ¶æ³å¤‰åŒ–æ™‚ |
| `feedback_request` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¦æ±‚ | åˆ†æå®Œäº†æ™‚ |
| `user_response` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ã®å¿œç­” | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›æ™‚ |
| `game_event` | ã‚²ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º | DisplayEffect/VisualEventå—ä¿¡æ™‚ |
| `knowledge_learned` | çŸ¥è­˜å­¦ç¿’é€šçŸ¥ | ã‚·ãƒŠã‚¸ãƒ¼ãƒ»ã‚³ãƒ³ãƒœæ¤œå‡ºæ™‚ |
| `system` | ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šæ™‚ |

---

## 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»•æ§˜

### 3.1 åŸºæœ¬æ§‹é€ 

```typescript
interface AIChatMessage {
  id: string;                    // UUID
  timestamp: Date;
  category: MessageCategory;
  priority: "high" | "medium" | "low";

  // è¡¨ç¤ºå†…å®¹
  content: MessageContent;

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  meta: {
    model: "haiku" | "sonnet" | "opus";
    tokenUsed?: number;
    latencyMs?: number;
    gameState?: {
      turn: number;
      round: number;
    };
  };

  // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  interaction?: MessageInteraction;
}

type MessageCategory =
  | "pregame_analysis"
  | "periodic_analysis"
  | "turn_decision"
  | "choice_response"
  | "strategy_update"
  | "feedback_request"
  | "user_response"
  | "game_event"
  | "knowledge_learned"
  | "system";

interface MessageContent {
  title: string;
  body: string;
  details?: ContentDetail[];
}

interface ContentDetail {
  label: string;
  value: string;
  type: "text" | "card" | "unit" | "keyword" | "warning";
}

interface MessageInteraction {
  type: "confirm" | "choice" | "rating" | "none";
  options?: InteractionOption[];
  selected?: string;
  feedback?: string;
}

interface InteractionOption {
  id: string;
  label: string;
  description?: string;
}
```

---

## 4. å…·ä½“çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

### 4.1 ã‚²ãƒ¼ãƒ é–‹å§‹å‰åˆ†æ (pregame_analysis)

```json
{
  "id": "msg-001",
  "timestamp": "2026-01-29T14:30:00.000Z",
  "category": "pregame_analysis",
  "priority": "high",
  "content": {
    "title": "ãƒ‡ãƒƒã‚­åˆ†æå®Œäº†",
    "body": "ã‚ãªãŸã®ãƒ‡ãƒƒã‚­ã‚’åˆ†æã—ã¾ã—ãŸã€‚ä¸­ç›¤ã®é€²åŒ–ãƒ©ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹ç›¤é¢åˆ¶åœ§ã‚’ä¸»è»¸ã¨ã™ã‚‹æ§‹ç¯‰ã§ã™ã€‚",
    "details": [
      {
        "label": "ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰",
        "value": "é­”å°†ãƒ»ä¿¡ç„ã€é€²åŒ–ã®ç§˜å®ã€ç´…è“®ã®é­”å°å¸«",
        "type": "card"
      },
      {
        "label": "æƒ³å®šãƒ—ãƒ©ãƒ³",
        "value": "åºç›¤ã¯CPã‚’æ¸©å­˜ã—ã€4-5ã‚¿ãƒ¼ãƒ³ç›®ã«é€²åŒ–ãƒ¦ãƒ‹ãƒƒãƒˆã‚’é€£ç¶šå±•é–‹",
        "type": "text"
      },
      {
        "label": "è­¦æˆ’ç‚¹",
        "value": "é»„è‰²ã®é™¤å»ã‚«ãƒ¼ãƒ‰ï¼ˆè£ãã®å…‰ã€ç¥ã®ä¸€æ’ƒï¼‰ã«æ³¨æ„",
        "type": "warning"
      },
      {
        "label": "å‹åˆ©æ¡ä»¶",
        "value": "é€²åŒ–ãƒ¦ãƒ‹ãƒƒãƒˆ2ä½“ä»¥ä¸Šã§ã®ã‚¢ã‚¿ãƒƒã‚¯æˆåŠŸ",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "opus",
    "tokenUsed": 2340,
    "latencyMs": 8500
  },
  "interaction": {
    "type": "confirm",
    "options": [
      {
        "id": "approve",
        "label": "ã“ã®æˆ¦ç•¥ã§é–‹å§‹",
        "description": "åˆ†æçµæœã‚’æ‰¿èªã—ã€ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™"
      },
      {
        "id": "reanalyze",
        "label": "å†åˆ†æ",
        "description": "ç•°ãªã‚‹è¦³ç‚¹ã§å†åº¦åˆ†æã‚’å®Ÿè¡Œã—ã¾ã™"
      },
      {
        "id": "aggressive",
        "label": "æ”»æ’ƒçš„ã«å¤‰æ›´",
        "description": "ã‚ˆã‚Šæ”»æ’ƒçš„ãªæˆ¦ç•¥ã«èª¿æ•´ã—ã¾ã™"
      },
      {
        "id": "defensive",
        "label": "å®ˆå‚™çš„ã«å¤‰æ›´",
        "description": "ã‚ˆã‚Šå®ˆå‚™çš„ãªæˆ¦ç•¥ã«èª¿æ•´ã—ã¾ã™"
      }
    ]
  }
}
```

### 4.2 å®šæœŸåˆ†æ (periodic_analysis)

```json
{
  "id": "msg-012",
  "timestamp": "2026-01-29T14:35:00.000Z",
  "category": "periodic_analysis",
  "priority": "medium",
  "content": {
    "title": "ãƒ©ã‚¦ãƒ³ãƒ‰2çµ‚äº†æ™‚åˆ†æ",
    "body": "ç›¸æ‰‹ã®æ¨æœ­ã‹ã‚‰é»„è‰²ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‡ãƒƒã‚­ã¨æ¨å®šã€‚é™¤å»ã‚«ãƒ¼ãƒ‰ã¸ã®è­¦æˆ’ã‚’å¼·åŒ–ã—ã¾ã™ã€‚",
    "details": [
      {
        "label": "ç›¸æ‰‹ãƒ‡ãƒƒã‚­ã‚¿ã‚¤ãƒ—",
        "value": "é»„è‰²ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆæ¨å®šç¢ºåº¦: 75%ï¼‰",
        "type": "text"
      },
      {
        "label": "ç›¸æ‰‹ã®æ¨æœ­å‚¾å‘",
        "value": "è£ãã®å…‰Ã—1ã€é¸ã°ã‚Œã—è€…Ã—1ãŒç¢ºèªæ¸ˆã¿",
        "type": "card"
      },
      {
        "label": "è­¦æˆ’ã‚«ãƒ¼ãƒ‰",
        "value": "ç¥ã®ä¸€æ’ƒï¼ˆæœªä½¿ç”¨ï¼‰ã€å¯©åˆ¤ã®å¤©ç§¤ï¼ˆæœªä½¿ç”¨ï¼‰",
        "type": "warning"
      },
      {
        "label": "æˆ¦ç•¥èª¿æ•´",
        "value": "ãƒ¦ãƒ‹ãƒƒãƒˆå±•é–‹ã‚’åˆ†æ•£ã—ã€ä¸€åº¦ã«2ä½“ä»¥ä¸Šä¸¦ã¹ãªã„",
        "type": "text"
      },
      {
        "label": "ç¾åœ¨ã®å„ªå‹¢åº¦",
        "value": "äº’è§’ï¼ˆãƒ©ã‚¤ãƒ•å·®: +1ï¼‰",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "opus",
    "tokenUsed": 1850,
    "latencyMs": 6200,
    "gameState": {
      "turn": 4,
      "round": 2
    }
  },
  "interaction": {
    "type": "none"
  }
}
```

### 4.3 ã‚¿ãƒ¼ãƒ³æ„æ€æ±ºå®š (turn_decision)

```json
{
  "id": "msg-015",
  "timestamp": "2026-01-29T14:36:30.000Z",
  "category": "turn_decision",
  "priority": "medium",
  "content": {
    "title": "ã‚¿ãƒ¼ãƒ³5: ãƒ¦ãƒ‹ãƒƒãƒˆå¬å–š",
    "body": "ç«œé¨å…µã‚’å¬å–šã—ã¾ã™ã€‚",
    "details": [
      {
        "label": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
        "value": "ç«œé¨å…µï¼ˆã‚³ã‚¹ãƒˆ3ï¼‰ã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¬å–š",
        "type": "unit"
      },
      {
        "label": "ç†ç”±",
        "value": "CPã‚’åŠ¹ç‡çš„ã«ä½¿ç”¨ã—ã€ç›¤é¢ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚’ç¶­æŒã€‚5000BPã§ç›¸æ‰‹ãƒ¦ãƒ‹ãƒƒãƒˆã¨ã®ç›¸æ‰“ã¡ãŒå¯èƒ½ã€‚",
        "type": "text"
      },
      {
        "label": "æ¬¡ã‚¿ãƒ¼ãƒ³å€™è£œ",
        "value": "é­”å°†ãƒ»ä¿¡ç„ã®é€²åŒ–ã§ç›¤é¢åˆ¶åœ§ã‚’ç‹™ã†",
        "type": "text"
      },
      {
        "label": "æ®‹ã‚ŠCP",
        "value": "1ï¼ˆæœ€å¤§4ï¼‰",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "sonnet",
    "tokenUsed": 420,
    "latencyMs": 650,
    "gameState": {
      "turn": 5,
      "round": 3
    }
  },
  "interaction": {
    "type": "none"
  }
}
```

### 4.4 é¸æŠè‚¢å¿œç­” (choice_response)

```json
{
  "id": "msg-018",
  "timestamp": "2026-01-29T14:37:15.000Z",
  "category": "choice_response",
  "priority": "high",
  "content": {
    "title": "ãƒ–ãƒ­ãƒƒã‚«ãƒ¼é¸æŠ",
    "body": "é­”å°†ãƒ»ä¿¡ç„ã§ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚",
    "details": [
      {
        "label": "é¸æŠ",
        "value": "é­”å°†ãƒ»ä¿¡ç„ï¼ˆBP 7000ï¼‰ã§ãƒ–ãƒ­ãƒƒã‚¯",
        "type": "unit"
      },
      {
        "label": "å¯¾è±¡",
        "value": "è’¼ç‚ã®é­”è¡“å¸«ï¼ˆBP 4000ï¼‰ã®ã‚¢ã‚¿ãƒƒã‚¯",
        "type": "unit"
      },
      {
        "label": "ç†ç”±",
        "value": "BPå·®+3000ã§ç¢ºå®Ÿã«æ’ƒç ´å¯èƒ½ã€‚ã€ä¸å±ˆã€‘ã«ã‚ˆã‚Šæ¬¡ã‚¿ãƒ¼ãƒ³ã‚‚ã‚¢ã‚¿ãƒƒã‚¯å¯èƒ½ã€‚",
        "type": "text"
      },
      {
        "label": "ãƒªã‚¹ã‚¯",
        "value": "ç›¸æ‰‹ã®ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã€‘ã«æ³¨æ„ã€‚ãƒˆãƒªã‚¬ãƒ¼ã‚¾ãƒ¼ãƒ³ã«ã‚«ãƒ¼ãƒ‰ã‚ã‚Šã€‚",
        "type": "warning"
      }
    ]
  },
  "meta": {
    "model": "haiku",
    "tokenUsed": 180,
    "latencyMs": 220,
    "gameState": {
      "turn": 5,
      "round": 3
    }
  },
  "interaction": {
    "type": "none"
  }
}
```

### 4.5 æˆ¦ç•¥å¤‰æ›´é€šçŸ¥ (strategy_update)

```json
{
  "id": "msg-022",
  "timestamp": "2026-01-29T14:40:00.000Z",
  "category": "strategy_update",
  "priority": "high",
  "content": {
    "title": "æˆ¦ç•¥å¤‰æ›´: å®ˆå‚™çš„ãƒ¢ãƒ¼ãƒ‰ã¸ç§»è¡Œ",
    "body": "ãƒ©ã‚¤ãƒ•å·®ãŒ-3ã¨ãªã£ãŸãŸã‚ã€å®ˆå‚™çš„ãªæˆ¦ç•¥ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚",
    "details": [
      {
        "label": "å¤‰æ›´ç†ç”±",
        "value": "ãƒ©ã‚¤ãƒ•3 vs 6ã§åŠ£å‹¢ã€‚ãƒªã‚½ãƒ¼ã‚¹æ¸©å­˜ã‚’å„ªå…ˆã€‚",
        "type": "text"
      },
      {
        "label": "æ–°æˆ¦ç•¥",
        "value": "ãƒ–ãƒ­ãƒƒã‚¯å„ªå…ˆã€ã‚¢ã‚¿ãƒƒã‚¯ã¯ç¢ºå®Ÿãªå ´é¢ã®ã¿",
        "type": "text"
      },
      {
        "label": "å‹ã¡ç­‹",
        "value": "JOKERç™ºå‹•ã«ã‚ˆã‚‹é€†è»¢ã€ã¾ãŸã¯ç›¸æ‰‹ã®ãƒ‡ãƒƒã‚­åˆ‡ã‚Œ",
        "type": "text"
      },
      {
        "label": "JOKERã‚²ãƒ¼ã‚¸",
        "value": "4/5ï¼ˆã‚ã¨1ã‚¿ãƒ¼ãƒ³ã§ç™ºå‹•å¯èƒ½ï¼‰",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "sonnet",
    "tokenUsed": 380,
    "latencyMs": 480,
    "gameState": {
      "turn": 8,
      "round": 4
    }
  },
  "interaction": {
    "type": "confirm",
    "options": [
      {
        "id": "accept",
        "label": "æ‰¿èª",
        "description": "å®ˆå‚™çš„æˆ¦ç•¥ã‚’æ¡ç”¨"
      },
      {
        "id": "aggressive",
        "label": "æ”»æ’ƒç¶™ç¶š",
        "description": "ãƒªã‚¹ã‚¯ã‚’å–ã£ã¦æ”»æ’ƒçš„ã«"
      }
    ]
  }
}
```

### 4.6 ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (system)

```json
{
  "id": "msg-030",
  "timestamp": "2026-01-29T14:42:00.000Z",
  "category": "system",
  "priority": "low",
  "content": {
    "title": "Opusåˆ†æã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œä¸­",
    "body": "æ¬¡ã®å®šæœŸåˆ†æã‚’æº–å‚™ã—ã¦ã„ã¾ã™ã€‚ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã«å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
    "details": [
      {
        "label": "äºˆå®šå®Œäº†",
        "value": "ç´„5ç§’å¾Œ",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "opus"
  },
  "interaction": {
    "type": "none"
  }
}
```

---

## 5. TOONå½¢å¼ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¾

ãƒˆãƒ¼ã‚¯ãƒ³åŠ¹ç‡ã‚’é«˜ã‚ã‚‹ãŸã‚ã€å†…éƒ¨é€šä¿¡ã«ã¯TOONå½¢å¼ã‚’ä½¿ç”¨å¯èƒ½:

### 5.1 ã‚¿ãƒ¼ãƒ³æ„æ€æ±ºå®šã®TOONè¡¨ç¾

```toon
msg:
  id: msg-015
  cat: turn_decision
  pri: medium

content:
  title: ã‚¿ãƒ¼ãƒ³5: ãƒ¦ãƒ‹ãƒƒãƒˆå¬å–š
  body: ç«œé¨å…µã‚’å¬å–šã—ã¾ã™ã€‚

details[4]{label,value,type}:
  ã‚¢ã‚¯ã‚·ãƒ§ãƒ³,ç«œé¨å…µï¼ˆã‚³ã‚¹ãƒˆ3ï¼‰ã‚’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å¬å–š,unit
  ç†ç”±,CPã‚’åŠ¹ç‡çš„ã«ä½¿ç”¨ã—ç›¤é¢ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚’ç¶­æŒ,text
  æ¬¡ã‚¿ãƒ¼ãƒ³å€™è£œ,é­”å°†ãƒ»ä¿¡ç„ã®é€²åŒ–ã§ç›¤é¢åˆ¶åœ§ã‚’ç‹™ã†,text
  æ®‹ã‚ŠCP,1ï¼ˆæœ€å¤§4ï¼‰,text

meta:
  model: sonnet
  tokens: 420
  latency: 650
  turn: 5
  round: 3
```

**å‰Šæ¸›åŠ¹æœ:** JSONæ¯”ã§ç´„45%ã®ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›

---

## 6. UIè¡¨ç¤ºä»•æ§˜

### 6.1 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚²ãƒ¼ãƒ ç”»é¢                                                  â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [AI Chat] â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” [âˆ’] [Ã—]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Opus] 14:30 ãƒ‡ãƒƒã‚­åˆ†æå®Œäº†                                  â”‚
â”‚   ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰: é­”å°†ãƒ»ä¿¡ç„ã€é€²åŒ–ã®ç§˜å®                          â”‚
â”‚   æƒ³å®šãƒ—ãƒ©ãƒ³: ä¸­ç›¤ã®é€²åŒ–ãƒ©ãƒƒã‚·ãƒ¥ã§ç›¤é¢åˆ¶åœ§                    â”‚
â”‚   [ã“ã®æˆ¦ç•¥ã§é–‹å§‹] [å†åˆ†æ] [æ”»æ’ƒçš„ã«] [å®ˆå‚™çš„ã«]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Sonnet] 14:36 ã‚¿ãƒ¼ãƒ³5: ç«œé¨å…µã‚’å¬å–š                         â”‚
â”‚   ç†ç”±: CPã‚’åŠ¹ç‡çš„ã«ä½¿ç”¨                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Haiku] 14:37 ãƒ–ãƒ­ãƒƒã‚«ãƒ¼é¸æŠ: é­”å°†ãƒ»ä¿¡ç„                     â”‚
â”‚   ç†ç”±: BPå·®+3000ã§ç¢ºå®Ÿæ’ƒç ´                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|-----------|
| è¡¨ç¤ºä½ç½® | bottom / right / floating | bottom |
| é«˜ã• | compact / normal / expanded | normal |
| è©³ç´°è¡¨ç¤º | å…¨è©³ç´° / è¦ç´„ã®ã¿ | è¦ç´„ã®ã¿ |
| ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚¸ | è¡¨ç¤º / éè¡¨ç¤º | è¡¨ç¤º |
| è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | æœ‰åŠ¹ / ç„¡åŠ¹ | æœ‰åŠ¹ |

### 6.3 ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| å„ªå…ˆåº¦ | èƒŒæ™¯è‰² | ç”¨é€” |
|--------|-------|------|
| high | `#FEE2E2` (èµ¤ç³») | é‡è¦ãªæˆ¦ç•¥å¤‰æ›´ã€è­¦å‘Š |
| medium | `#FEF3C7` (é»„ç³») | é€šå¸¸ã®æ„æ€æ±ºå®š |
| low | `#E0E7FF` (é’ç³») | ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ã€æƒ…å ± |

---

## 7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

### 7.1 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¿ã‚¤ãƒ—

| ã‚¿ã‚¤ãƒ— | èª¬æ˜ | å¿œç­”å½¢å¼ |
|--------|------|----------|
| `confirm` | æ‰¿èª/æ‹’å¦ | ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ |
| `choice` | è¤‡æ•°é¸æŠè‚¢ã‹ã‚‰é¸æŠ | ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ |
| `rating` | è©•ä¾¡ (1-5) | ã‚¹ã‚¿ãƒ¼é¸æŠ |
| `text` | è‡ªç”±è¨˜è¿° | ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› |

### 7.2 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¿œç­”ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```typescript
interface UserFeedback {
  messageId: string;
  interactionType: "confirm" | "choice" | "rating" | "text";
  response: {
    selected?: string;      // confirm/choice ã®å ´åˆ
    rating?: number;        // rating ã®å ´åˆ (1-5)
    text?: string;          // text ã®å ´åˆ
  };
  timestamp: Date;
}
```

### 7.3 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¾‹

```json
{
  "messageId": "msg-001",
  "interactionType": "confirm",
  "response": {
    "selected": "aggressive"
  },
  "timestamp": "2026-01-29T14:30:15.000Z"
}
```

### 7.4 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

æ‰¿èª/é¸æŠä»¥å¤–ã®è‡ªç”±ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€ä¿¡å¯èƒ½:

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

```typescript
interface UserChatMessage {
  id: string;
  timestamp: Date;
  content: string;
  threadTarget: "game_session" | "pregame" | "periodic";
}

interface AIConversationResponse {
  id: string;
  timestamp: Date;
  category: "user_response";
  priority: "medium";
  content: {
    title: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å¿œç­”";
    body: string;
    details?: ContentDetail[];
  };
  meta: {
    model: "sonnet" | "opus";  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯Sonnetä»¥ä¸Š
    tokenUsed: number;
    inResponseTo: string;      // å…ƒã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID
  };
  knowledgeExtracted?: {
    stored: boolean;
    entry?: KnowledgeEntrySummary;
  };
}

interface KnowledgeEntrySummary {
  topic: string;
  insight: string;
  type: "preference" | "strategy" | "correction" | "insight";
}
```

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```json
{
  "id": "user-msg-001",
  "timestamp": "2026-01-29T14:38:00.000Z",
  "content": "ã“ã®å¯¾æˆ¦ç›¸æ‰‹ã¯æ¯å›ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã‚’æ¸©å­˜ã—ã¦ãã‚‹å‚¾å‘ãŒã‚ã‚‹ã‹ã‚‰ã€ã‚‚ã£ã¨è­¦æˆ’ã—ã¦",
  "threadTarget": "game_session"
}
```

#### AIå¿œç­”ä¾‹

```json
{
  "id": "msg-025",
  "timestamp": "2026-01-29T14:38:02.000Z",
  "category": "user_response",
  "priority": "medium",
  "content": {
    "title": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å¿œç­”",
    "body": "äº†è§£ã—ã¾ã—ãŸã€‚ç›¸æ‰‹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆæ¸©å­˜å‚¾å‘ã‚’è€ƒæ…®ã—ã€ä»¥ä¸‹ã®å¯¾ç­–ã‚’å–ã‚Šã¾ã™ï¼š",
    "details": [
      {
        "label": "æˆ¦ç•¥èª¿æ•´",
        "value": "ã‚¢ã‚¿ãƒƒã‚¯å‰ã«ç›¸æ‰‹ã®æ‰‹æœ­æšæ•°ã¨CPã‚’ç¢ºèªã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆç™ºå‹•ã®å¯èƒ½æ€§ã‚’é‡è¦–",
        "type": "text"
      },
      {
        "label": "ãƒªã‚¹ã‚¯å›é¿",
        "value": "é‡è¦ãƒ¦ãƒ‹ãƒƒãƒˆã§ã®å˜ç‹¬ã‚¢ã‚¿ãƒƒã‚¯ã‚’æ§ãˆã€è¤‡æ•°ã‚¢ã‚¿ãƒƒã‚¯ã§èª˜ç™ºã‚’ç‹™ã†",
        "type": "text"
      }
    ]
  },
  "meta": {
    "model": "sonnet",
    "tokenUsed": 320,
    "inResponseTo": "user-msg-001"
  },
  "knowledgeExtracted": {
    "stored": true,
    "entry": {
      "topic": "å¯¾æˆ¦ç›¸æ‰‹ã®å‚¾å‘",
      "insight": "ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã‚’æ¸©å­˜ã™ã‚‹å‚¾å‘ãŒã‚ã‚‹ã€‚ã‚¢ã‚¿ãƒƒã‚¯æ™‚ã¯è­¦æˆ’ã‚’å¼·åŒ–ã€‚",
      "type": "insight"
    }
  }
}
```

### 7.5 ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¢ã‚¯ã‚»ã‚¹

Pregame/Periodicã‚¹ãƒ¬ãƒƒãƒ‰ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹UI:

#### ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º

```typescript
interface BackgroundThreadStatus {
  type: "pregame" | "periodic";
  status: "idle" | "running" | "completed" | "error";
  progress?: number;
  lastResult?: {
    timestamp: Date;
    summary: string;
  };
  canInteract: boolean;
}
```

#### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```json
{
  "id": "user-msg-002",
  "timestamp": "2026-01-29T14:45:00.000Z",
  "content": "ç›¸æ‰‹ã®ãƒ‡ãƒƒã‚­ã«ã¤ã„ã¦ã‚‚ã†å°‘ã—è©³ã—ãåˆ†æã—ã¦",
  "threadTarget": "periodic"
}
```

#### ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰UIè¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å®šæœŸåˆ†æã‚¹ãƒ¬ãƒƒãƒ‰]                              [å±•é–‹] [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status: åˆ†æå®Œäº† (14:35)                                     â”‚
â”‚ æ¬¡å›åˆ†æ: ãƒ©ã‚¦ãƒ³ãƒ‰4çµ‚äº†æ™‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Opus] æœ€æ–°åˆ†æçµæœ:                                         â”‚
â”‚   ç›¸æ‰‹ãƒ‡ãƒƒã‚­: é»„è‰²ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« (ç¢ºåº¦75%)                      â”‚
â”‚   è­¦æˆ’ã‚«ãƒ¼ãƒ‰: ç¥ã®ä¸€æ’ƒã€å¯©åˆ¤ã®å¤©ç§¤                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¥åŠ›] è¿½åŠ ã§åˆ†æã—ã¦ã»ã—ã„ã“ã¨ã‚’å…¥åŠ›...           [é€ä¿¡]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7.6 ã‚²ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º (DisplayEffect/VisualEvent)

ã‚²ãƒ¼ãƒ ä¸­ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒãƒ£ãƒƒãƒˆã«è»½é‡è¡¨ç¤º:

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ†ã‚´ãƒª

```typescript
interface GameEventMessage {
  id: string;
  timestamp: Date;
  category: "game_event";
  priority: "low";
  content: {
    title: string;          // ä¾‹: "åŠ¹æœç™ºå‹•", "ãƒˆãƒªã‚¬ãƒ¼ç™ºå‹•"
    body: string;           // ä¾‹: "è£ãã®å…‰ â†’ ç«œé¨å…µã‚’ç ´å£Š"
  };
  meta: {
    eventType: "display_effect" | "visual_effect" | "trigger";
    source?: string;        // ç™ºå‹•å…ƒã‚«ãƒ¼ãƒ‰å
    target?: string;        // å¯¾è±¡ã‚«ãƒ¼ãƒ‰å
    gameState: {
      turn: number;
      round: number;
    };
  };
}
```

### ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºä¾‹

```json
{
  "id": "evt-001",
  "timestamp": "2026-01-29T14:36:45.000Z",
  "category": "game_event",
  "priority": "low",
  "content": {
    "title": "åŠ¹æœç™ºå‹•",
    "body": "ã€ä¸å±ˆã€‘: é­”å°†ãƒ»ä¿¡ç„ â†’ è¡Œå‹•æ¨©å›å¾©"
  },
  "meta": {
    "eventType": "display_effect",
    "source": "é­”å°†ãƒ»ä¿¡ç„",
    "gameState": {
      "turn": 5,
      "round": 3
    }
  }
}
```

```json
{
  "id": "evt-002",
  "timestamp": "2026-01-29T14:37:20.000Z",
  "category": "game_event",
  "priority": "low",
  "content": {
    "title": "ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆ",
    "body": "è£ãã®å…‰ â†’ ç«œé¨å…µã‚’ç ´å£Š"
  },
  "meta": {
    "eventType": "display_effect",
    "source": "è£ãã®å…‰",
    "target": "ç«œé¨å…µ",
    "gameState": {
      "turn": 5,
      "round": 3
    }
  }
}
```

### ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºè¨­å®š

| è¨­å®š | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|------|------|-----------|
| showGameEvents | ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã‹ | true |
| eventDetailLevel | "full" / "minimal" / "none" | "minimal" |
| groupSimilarEvents | é€£ç¶šã™ã‚‹åŒç¨®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ– | true |
| eventOpacity | ã‚¤ãƒ™ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€æ˜åº¦ (0-1) | 0.7 |

### ãƒãƒ£ãƒƒãƒˆå†…ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºã‚¤ãƒ¡ãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Sonnet] 14:36 ã‚¿ãƒ¼ãƒ³5: ç«œé¨å…µã‚’å¬å–š                         â”‚
â”‚   ç†ç”±: CPã‚’åŠ¹ç‡çš„ã«ä½¿ç”¨                                     â”‚
â”œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤
â”‚   [evt] ã€è²«é€šã€‘: ç«œé¨å…µã«ä»˜ä¸                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Haiku] 14:37 ãƒ–ãƒ­ãƒƒã‚«ãƒ¼é¸æŠ: é­”å°†ãƒ»ä¿¡ç„                     â”‚
â”œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤
â”‚   [evt] è£ãã®å…‰ â†’ ç«œé¨å…µã‚’ç ´å£Š                              â”‚
â”‚   [evt] ã€ä¸å±ˆã€‘: é­”å°†ãƒ»ä¿¡ç„ â†’ è¡Œå‹•æ¨©å›å¾©                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒƒãƒå‡¦ç†

ã‚¤ãƒ™ãƒ³ãƒˆã¯é€£ç¶šã—ã¦ç™ºç”Ÿã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§APIå‘¼ã³å‡ºã—ã‚’è¡Œã†:

| ãƒˆãƒªã‚¬ãƒ¼ | èª¬æ˜ |
|---------|------|
| `Choices` | é¸æŠè‚¢ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æ™‚ |
| `Operation(defrost)` | freezeå¾Œã®defrostæ™‚ |
| `DisplayEffect(Continue)` | ç¶šè¡Œç¢ºèªè¦æ±‚æ™‚ |

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
```
ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ â†’ UIã«å³åº§ã«è¡¨ç¤º + ãƒãƒƒãƒ•ã‚¡ã«è“„ç©
            â†“
åˆ¤æ–­ãƒˆãƒªã‚¬ãƒ¼å—ä¿¡ â†’ ãƒãƒƒãƒ•ã‚¡å†…ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦APIã«é€ä¿¡
```

**ã‚¿ã‚¤ãƒãƒ¼ä¸ä½¿ç”¨:** ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã‚„ã‚¿ã‚¤ãƒãƒ¼ã¯ä½¿ç”¨ã›ãšã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã™ã‚‹

---

## 7.7 çŸ¥è­˜å­¦ç¿’é€šçŸ¥ (knowledge_learned)

ã‚²ãƒ¼ãƒ ä¸­ã«è‡ªå‹•å­¦ç¿’ã•ã‚ŒãŸã‚·ãƒŠã‚¸ãƒ¼ãƒ»ã‚³ãƒ³ãƒœãƒ»å¯¾ç­–ã‚’é€šçŸ¥:

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ 

```typescript
interface KnowledgeLearnedMessage {
  id: string;
  timestamp: Date;
  category: "knowledge_learned";
  priority: "low";
  content: {
    title: string;          // ä¾‹: "ã‚·ãƒŠã‚¸ãƒ¼æ¤œå‡º", "ã‚³ãƒ³ãƒœå­¦ç¿’"
    body: string;           // å­¦ç¿’å†…å®¹ã®èª¬æ˜
    details?: ContentDetail[];
  };
  meta: {
    knowledgeId: string;    // ä¿å­˜ã•ã‚ŒãŸçŸ¥è­˜ID
    knowledgeType: "synergy" | "combo" | "counter" | "deck_pattern";
    source: "observation" | "analysis";
    confidence: number;
  };
  tags: {
    colors?: number[];
    cardNames?: string[];
  };
}
```

### çŸ¥è­˜å­¦ç¿’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

#### ã‚·ãƒŠã‚¸ãƒ¼æ¤œå‡º

```json
{
  "id": "msg-030",
  "timestamp": "2026-01-29T14:42:00.000Z",
  "category": "knowledge_learned",
  "priority": "low",
  "content": {
    "title": "ã‚·ãƒŠã‚¸ãƒ¼æ¤œå‡º",
    "body": "ç›¸æ‰‹ã®ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æœ‰åŠ¹ãªã‚·ãƒŠã‚¸ãƒ¼ã‚’å­¦ç¿’ã—ã¾ã—ãŸã€‚",
    "details": [
      {
        "label": "ã‚«ãƒ¼ãƒ‰çµ„ã¿åˆã‚ã›",
        "value": "é­”å°†ãƒ»ä¿¡ç„ + çªæ’ƒå‘½ä»¤",
        "type": "card"
      },
      {
        "label": "åŠ¹æœ",
        "value": "ã€ä¸å±ˆã€‘ã§è¡Œå‹•æ¨©å›å¾©å¾Œã€å…¨ä½“BPä¸Šæ˜‡ã§è¿½åŠ ã‚¢ã‚¿ãƒƒã‚¯",
        "type": "text"
      }
    ]
  },
  "meta": {
    "knowledgeId": "know-001",
    "knowledgeType": "synergy",
    "source": "observation",
    "confidence": 0.85
  },
  "tags": {
    "colors": [1],
    "cardNames": ["é­”å°†ãƒ»ä¿¡ç„", "çªæ’ƒå‘½ä»¤"]
  }
}
```

#### ãƒ‡ãƒƒã‚­ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’

```json
{
  "id": "msg-031",
  "timestamp": "2026-01-29T14:45:00.000Z",
  "category": "knowledge_learned",
  "priority": "low",
  "content": {
    "title": "ãƒ‡ãƒƒã‚­ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’",
    "body": "ç›¸æ‰‹ãƒ‡ãƒƒã‚­ã®å‚¾å‘ã‚’è¨˜éŒ²ã—ã¾ã—ãŸã€‚æ¬¡å›å¯¾æˆ¦æ™‚ã«æ´»ç”¨ã—ã¾ã™ã€‚",
    "details": [
      {
        "label": "ãƒ‡ãƒƒã‚­ã‚¿ã‚¤ãƒ—",
        "value": "èµ¤å˜ã‚¢ã‚°ãƒ­",
        "type": "text"
      },
      {
        "label": "ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰",
        "value": "é­”å°†ãƒ»ä¿¡ç„, ç‚ã®æ§, ç´…è“®ã®é­”è¡“å¸«",
        "type": "card"
      },
      {
        "label": "è­¦æˆ’ãƒã‚¤ãƒ³ãƒˆ",
        "value": "åºç›¤ã®é€Ÿæ”»ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ãƒˆã«ã‚ˆã‚‹è¿½æ’ƒ",
        "type": "warning"
      }
    ]
  },
  "meta": {
    "knowledgeId": "know-002",
    "knowledgeType": "deck_pattern",
    "source": "analysis",
    "confidence": 0.92
  },
  "tags": {
    "colors": [1],
    "cardNames": ["é­”å°†ãƒ»ä¿¡ç„", "ç‚ã®æ§", "ç´…è“®ã®é­”è¡“å¸«"]
  }
}
```

### çŸ¥è­˜å­¦ç¿’UIè¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å­¦ç¿’] 14:42 ã‚·ãƒŠã‚¸ãƒ¼æ¤œå‡º                               ğŸ’¡  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é­”å°†ãƒ»ä¿¡ç„ + çªæ’ƒå‘½ä»¤                                       â”‚
â”‚ ã€ä¸å±ˆã€‘ã§è¡Œå‹•æ¨©å›å¾©å¾Œã€å…¨ä½“BPä¸Šæ˜‡ã§è¿½åŠ ã‚¢ã‚¿ãƒƒã‚¯            â”‚
â”‚ ä¿¡é ¼åº¦: 85% | è‰²: èµ¤                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŸ¥è­˜å­¦ç¿’è¡¨ç¤ºè¨­å®š

| è¨­å®š | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|------|------|-----------|
| showKnowledgeLearned | å­¦ç¿’é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ã‹ | true |
| minConfidenceToShow | è¡¨ç¤ºã™ã‚‹æœ€å°ä¿¡é ¼åº¦ | 0.7 |
| knowledgeOpacity | å­¦ç¿’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€æ˜åº¦ | 0.8 |

---

## 8. çŠ¶æ…‹ç®¡ç†

### 8.1 Zustandã‚¹ãƒˆã‚¢å®šç¾©

```typescript
interface AIChatStore {
  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´
  messages: AIChatMessage[];

  // è¡¨ç¤ºè¨­å®š
  settings: {
    position: "bottom" | "right" | "floating";
    height: "compact" | "normal" | "expanded";
    detailLevel: "full" | "summary";
    showModelBadge: boolean;
    autoScroll: boolean;
    isVisible: boolean;
  };

  // æœªèª­ç®¡ç†
  unreadCount: number;
  lastReadTimestamp: Date | null;

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  addMessage: (message: AIChatMessage) => void;
  updateMessage: (id: string, update: Partial<AIChatMessage>) => void;
  submitFeedback: (feedback: UserFeedback) => void;
  clearMessages: () => void;
  updateSettings: (settings: Partial<AIChatStore['settings']>) => void;
  markAsRead: () => void;
}
```

---

## 9. ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
/src/components/ai/
â”œâ”€â”€ AIChat.tsx                     # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
â”œâ”€â”€ AIChatHeader.tsx               # ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœ€å°åŒ–/é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ï¼‰
â”œâ”€â”€ AIChatMessageList.tsx          # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆ
â”œâ”€â”€ AIChatMessage.tsx              # å€‹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
â”œâ”€â”€ AIChatMessageDetail.tsx        # è©³ç´°å±•é–‹è¡¨ç¤º
â”œâ”€â”€ AIChatInteraction.tsx          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
â”œâ”€â”€ AIChatModelBadge.tsx           # ãƒ¢ãƒ‡ãƒ«ãƒãƒƒã‚¸ (Haiku/Sonnet/Opus)
â”œâ”€â”€ AIChatSettings.tsx             # è¨­å®šãƒ‘ãƒãƒ«
â”œâ”€â”€ AIChatInput.tsx                # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
â”œâ”€â”€ AIChatGameEvent.tsx            # ã‚²ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º
â”œâ”€â”€ AIChatBackgroundThread.tsx     # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰UI
â””â”€â”€ hooks/
    â”œâ”€â”€ useAIChatStore.ts          # Zustandã‚¹ãƒˆã‚¢
    â”œâ”€â”€ useAIChatMessages.ts       # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†
    â”œâ”€â”€ useAIChatSettings.ts       # è¨­å®šç®¡ç†
    â”œâ”€â”€ useUserMessage.ts          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
    â”œâ”€â”€ useBackgroundThread.ts     # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
    â””â”€â”€ useKnowledgeStore.ts       # Knowledge LocalStorageç®¡ç†

/src/ai/
â”œâ”€â”€ chat/
â”‚   â”œâ”€â”€ types.ts                   # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹å®šç¾©
â”‚   â”œâ”€â”€ formatter.ts               # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
â”‚   â”œâ”€â”€ toon.ts                    # TOONå¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ eventConverter.ts          # DisplayEffect/VisualEventå¤‰æ›
â”‚
â”œâ”€â”€ thread/
â”‚   â”œâ”€â”€ types.ts                   # ã‚¹ãƒ¬ãƒƒãƒ‰å‹å®šç¾©
â”‚   â”œâ”€â”€ ThreadManager.ts           # ã‚¹ãƒ¬ãƒƒãƒ‰ç®¡ç†
â”‚   â”œâ”€â”€ GameSessionThread.ts       # ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã‚¹ãƒ¬ãƒƒãƒ‰
â”‚   â”œâ”€â”€ PregameThread.ts           # ã‚²ãƒ¼ãƒ é–‹å§‹å‰åˆ†æã‚¹ãƒ¬ãƒƒãƒ‰
â”‚   â”œâ”€â”€ PeriodicThread.ts          # å®šæœŸåˆ†æã‚¹ãƒ¬ãƒƒãƒ‰
â”‚   â””â”€â”€ ContextWindowManager.ts    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç®¡ç†
â”‚
â””â”€â”€ knowledge/
    â”œâ”€â”€ types.ts                   # Knowledgeå‹å®šç¾©
    â”œâ”€â”€ KnowledgeStore.ts          # LocalStorageç®¡ç†
    â”œâ”€â”€ KnowledgeExtractor.ts      # ä¼šè©±ã‹ã‚‰ã®çŸ¥è­˜æŠ½å‡º
    â””â”€â”€ KnowledgeInjector.ts       # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸ã®çŸ¥è­˜æ³¨å…¥
```

---

## 10. å®Ÿè£…å„ªå…ˆé †ä½

| Phase | æ©Ÿèƒ½ | å„ªå…ˆåº¦ |
|-------|------|--------|
| 1 | åŸºæœ¬ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º | P0 |
| 1 | ã‚¿ãƒ¼ãƒ³æ„æ€æ±ºå®šè¡¨ç¤º | P0 |
| 1 | è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ | P0 |
| 1 | ã‚²ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º (DisplayEffect/VisualEvent) | P1 |
| 2 | ã‚²ãƒ¼ãƒ é–‹å§‹å‰åˆ†æ + ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ | P0 |
| 2 | å®šæœŸåˆ†æè¡¨ç¤º | P1 |
| 2 | è©³ç´°å±•é–‹è¡¨ç¤º | P1 |
| 2 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› + AIå¿œç­” | P1 |
| 3 | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰UI | P1 |
| 3 | Knowledge Storage (LocalStorage) | P2 |
| 3 | è¨­å®šãƒ‘ãƒãƒ« | P2 |
| 3 | ä½ç½®å¤‰æ›´ | P2 |
| 3 | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | P3 |

---

## ä»˜éŒ²A: å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—ã®æ¦‚è¦

| Category | é »åº¦ | ãƒ¢ãƒ‡ãƒ« | å„ªå…ˆåº¦ | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ |
|----------|------|--------|--------|-----------------|
| pregame_analysis | 1å›/ã‚²ãƒ¼ãƒ  | Opus | high | confirm/choice |
| periodic_analysis | 1å›/2ãƒ©ã‚¦ãƒ³ãƒ‰ | Opus | medium | none |
| turn_decision | è¤‡æ•°å›/ã‚¿ãƒ¼ãƒ³ | Sonnet | medium | none |
| choice_response | éšæ™‚ | Haiku | medium-high | none |
| strategy_update | çŠ¶æ³ã«å¿œã˜ã¦ | Sonnet | high | confirm |
| feedback_request | éšæ™‚ | - | high | choice/text |
| user_response | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›æ™‚ | Sonnet/Opus | medium | none |
| game_event | ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ | - | low | none |
| knowledge_learned | ã‚·ãƒŠã‚¸ãƒ¼/ã‚³ãƒ³ãƒœæ¤œå‡ºæ™‚ | - | low | none |
| system | éšæ™‚ | - | low | none |
