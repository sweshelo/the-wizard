# Phase 2: 推論改善

## 目標

AIの判断精度を向上させ、より戦略的なプレイを実現

## 前提条件

- Phase 1 が完了していること

## タスク一覧

| タスクID | タスク名 | 優先度 | 依存関係 | ステータス |
|----------|----------|--------|----------|------------|
| 2.1 | カタログ情報の活用 | P0 | Phase 1 | NOT_STARTED |
| 2.2 | 戦略プロンプトの洗練 | P0 | 2.1 | NOT_STARTED |
| 2.3 | 攻撃/ブロック判断 | P0 | 2.2 | NOT_STARTED |
| 2.4 | インターセプト判断 | P0 | 2.3 | NOT_STARTED |
| 2.5 | ゲーム開始前分析 (Opus) | P0 | 2.2 | NOT_STARTED |
| 2.6 | ユーザーフィードバック機能 | P1 | 2.5 | NOT_STARTED |

## 依存関係図

```
Phase 1 完了
    │
    └──▶ TASK-2.1 (カタログ情報の活用)
           │
           └──▶ TASK-2.2 (戦略プロンプトの洗練)
                   │
                   ├──▶ TASK-2.3 (攻撃/ブロック判断)
                   │       │
                   │       └──▶ TASK-2.4 (インターセプト判断)
                   │
                   └──▶ TASK-2.5 (ゲーム開始前分析)
                           │
                           └──▶ TASK-2.6 (ユーザーフィードバック)
```

---

## 詳細タスク

### TASK-2.1: カタログ情報の活用

**目的:** カード効果テキストをAI判断に活用

**成果物:**
- `/src/ai/catalog/CatalogService.ts`
- `/src/ai/catalog/KeywordService.ts`
- `/src/ai/catalog/CatalogCache.ts`

**テストケース (TDD):**
1. カードIDからカード情報を取得
2. カード名からカード情報を検索
3. キーワード能力の説明を取得
4. キャッシュが正しく機能すること

---

### TASK-2.2: 戦略プロンプトの洗練

**目的:** より詳細な戦略指示をプロンプトに含める

**成果物:**
- `/src/ai/prompts/strategy.ts`
- `/src/ai/prompts/analysis.ts`

**テストケース (TDD):**
1. 色別戦略がプロンプトに含まれること
2. 状況別アドバイスが生成されること

---

### TASK-2.3: 攻撃/ブロック判断

**目的:** BP比較、相手手札、トリガーゾーンを考慮した判断

**成果物:**
- `/src/ai/tactics/AttackEvaluator.ts`
- `/src/ai/tactics/BlockEvaluator.ts`

**テストケース (TDD):**
1. BP差に基づく攻撃優先順位
2. 相手手札枚数による警戒度調整
3. トリガーゾーン考慮
4. 複数ブロッカー候補からの選択

---

### TASK-2.4: インターセプト判断

**目的:** インターセプトカードの使用タイミング判断

**成果物:**
- `/src/ai/tactics/InterceptEvaluator.ts`

**テストケース (TDD):**
1. 発動可能なインターセプトの判定
2. 発動価値の評価
3. 温存判断

---

### TASK-2.5: ゲーム開始前分析 (Opus)

**目的:** デッキ分析と戦略立案

**成果物:**
- `/src/ai/PreGameAnalyzer.ts`
- `/src/ai/thread/PregameThread.ts`
- `/src/ai/prompts/pregame.ts`

**テストケース (TDD):**
1. デッキ構成の分析
2. キーカードの特定
3. 戦略提案の生成
4. Chat UIへの結果表示

---

### TASK-2.6: ユーザーフィードバック機能

**目的:** ゲーム開始前分析へのユーザーフィードバック受付

**成果物:**
- `/src/components/ai/AIChatInteraction.tsx`
- `/src/components/ai/hooks/useFeedback.ts`

**テストケース (TDD):**
1. フィードバックボタンの表示
2. 選択結果の送信
3. 戦略調整の反映

---

## 完了条件

- [ ] 全タスクのステータスが COMPLETED
- [ ] 全テストがパス
- [ ] カタログ情報がAI判断に活用されている
- [ ] ゲーム開始前にOpusによる分析が表示される
- [ ] ユーザーが戦略にフィードバックできる
